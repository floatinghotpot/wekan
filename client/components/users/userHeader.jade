template(name="headerUserBar")
  #header-user-bar
    a.header-user-bar-name.js-open-header-member-menu
      .header-user-bar-avatar
        +userAvatar(userId=currentUser._id)
      unless isMiniScreen
        if currentUser.profile.fullname
          = currentUser.profile.fullname
        else
          = currentUser.username

template(name="memberMenuPopup")
  ul.pop-over-list
    with currentUser
      li: a.js-edit-profile {{_ 'edit-profile'}}
    li: a.js-change-avatar {{_ 'edit-avatar'}}
    li: a.js-change-password {{_ 'changePasswordPopup-title'}}
    li: a.js-change-language {{_ 'changeLanguagePopup-title'}}
    li: a.js-edit-notification {{_ 'editNotificationPopup-title'}}
  hr
  ul.pop-over-list
    li: a.js-logout {{_ 'log-out'}}

template(name="editProfilePopup")
  form
    label
      | {{_ 'fullname'}}
      input.js-profile-fullname(type="text" value=profile.fullname autofocus)
    label
      | {{_ 'username'}}
      input.js-profile-username(type="text" value=username)
    label
      | {{_ 'initials'}}
      input.js-profile-initials(type="text" value=profile.initials)
      | {{_ 'qq'}}
    label
      input.js-profile-qq(type="text" value=profile.qq)
    input.primary.wide(type="submit" value="{{_ 'save'}}")

template(name="editNotificationPopup")
  ul.pop-over-list
    li
      a.js-toggle-tag-notify-participate
        i.fa(class="{{#if hasTag 'notify-participate'}}fa-check-square-o{{else}}fa-square-o{{/if}}")
        | {{_ 'participating'}}
        span.sub-name {{_ 'notify-participate'}}
  ul.pop-over-list
    li
      a.js-toggle-tag-notify-watch
        i.fa(class="{{#if hasTag 'notify-watch'}}fa-check-square-o{{else}}fa-square-o{{/if}}")
        | {{_ 'watching'}}
        span.sub-name {{_ 'notify-watch'}}
  hr
  ul.pop-over-list
    li
      a.js-toggle-tag-notify-email
        i.fa(class="{{#if hasTag 'notify-email'}}fa-check-square-o{{else}}fa-square-o{{/if}}")
        | {{_ 'email'}}
        span.sub-name {{_ 'notify-email'}}
  ul.pop-over-list
    li
      a.js-toggle-tag-notify-qq
        i.fa(class="{{#if hasTag 'notify-qq'}}fa-check-square-o{{else}}fa-square-o{{/if}}")
        | {{_ 'qq'}}
        span.sub-name {{_ 'notify-qq'}}

template(name="changePasswordPopup")
  +atForm(state='changePwd')

template(name="changeLanguagePopup")
  ul.pop-over-list
    each languages
      li(class="{{# if isCurrentLanguage}}active{{/if}}")
        a.js-set-language
          = name
          if isCurrentLanguage
            i.fa.fa-check
